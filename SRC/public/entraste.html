<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Salas</title>
<style>
body {
    margin: 0;
    background: #e9e9e9;
    font-family: sans-serif;
    color: rgb(0, 0, 0);
}
.rooms-container {
    padding: 20px;
}
.rooms-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
#addRoomBtn {
    padding: 8px 14px;
    border-radius: 20px;
    border: none;
    background: #433af0;
    color: white;
    cursor: pointer;
}
#rooms {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.room {
    background: #ffffff;
    border-radius: 25px;
    padding: 20px;
}
.room button {
    margin-top: 10px;
    width: 100%;
    border: none;
    border-radius: 20px;
    padding: 8px;
    cursor: pointer;
    background: #35ee79;
    color: black;
}
.room.full button {
    background: #888;
    cursor: not-allowed;
}
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: #ffffff;
    padding: 20px;
    border-radius: 20px;
    width: 300px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.hidden {
    display: none;
}
</style>
</head>
<body>

<div class="rooms-container">
    <div class="rooms-header">
        <h2>Salas</h2>
        <button id="addRoomBtn">+ Add</button>
    </div>
    <div id="rooms"></div>
</div>

<div id="modal" class="modal hidden">
    <div class="modal-content">
        <h3>Nueva sala</h3>
        <input type="text" id="roomName" placeholder="Nombre de la sala">
        <textarea id="roomDesc" placeholder="DescripciÃ³n"></textarea>
        <button id="createRoom">Crear</button>
        <button id="closeModal">Cancelar</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const roomsDiv = document.getElementById("rooms");
const modal = document.getElementById("modal");

function fetchRooms() {
    fetch("/api/rooms")
    .then(res => res.json())
    .then(data => renderRooms(data));
}

function renderRooms(rooms) {
    roomsDiv.innerHTML = "";
    rooms.forEach(room => {
        const div = document.createElement("div");
        div.className = "room" + (room.users >= 4 ? " full" : "");
        div.innerHTML = `
            <h3>${room.name}</h3>
            <p>${room.desc}</p>
            <p class="usersCount">${room.users}/4 personas</p>
            <button ${room.users >= 4 ? "disabled" : ""}>Entrar</button>
        `;
        div.querySelector("button").addEventListener("click", () => {
            if(room.users < 4) {
                window.location.href = `/sala.html?id=${room.id}`;
            }
        });
        roomsDiv.appendChild(div);
    });
}

document.getElementById("addRoomBtn").onclick = () => modal.classList.remove("hidden");
document.getElementById("closeModal").onclick = () => modal.classList.add("hidden");
document.getElementById("createRoom").onclick = () => {
    const name = document.getElementById("roomName").value;
    const desc = document.getElementById("roomDesc").value;
    if(!name) return;
    fetch("/api/rooms", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, desc })
    }).then(() => {
        modal.classList.add("hidden");
        fetchRooms();
    });
};

socket.on("updateRooms", rooms => renderRooms(rooms));
fetchRooms();
</script>

</body>
</html>
